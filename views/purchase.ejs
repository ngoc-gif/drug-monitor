<!-- add header -->
<%- include('includes/_header') %>
<!-- end header -->
<!-- Main section -->
<main id="main">

	<h2>Calculate Drugs to purchase</h2>
	<p>For how many days do you want to purchase drugs?</p> 
	
	<form id="drug_days">
		<input type="number" id="days" value="30" min="1"> 
		<button type="submit">Enter</button>
	</form>

	<table id="purchase_table">	
		<thead>
			<tr>
				<th>ID</th>
				<th>Drug Name</th>
				<th>Cards to Buy</th>
				<th>Packs to Buy</th>
			</tr>
		</thead>
		<tbody id="purchase_body">
			<!-- Loop through drugs and render initial rows -->
			<% for(let i = 0; i < drugs.length; i++) { %>
				<tr>
					<td><%= i + 1 %></td>
					<td><%= drugs[i].name %></td>
					<td></td>
					<td></td>
				</tr>
			<% } %>
		</tbody>
	</table>
</main>
<!-- End main section -->

<script>
	const drugs = <%- JSON.stringify(drugs) %>; 
	const form = document.getElementById('drug_days');
	const daysInput = document.getElementById('days');
	const tableBody = document.getElementById('purchase_body');

	function renderTable(days) {
		tableBody.innerHTML = '';
		drugs.forEach((drug, index) => {
			const pills = days * drug.perDay;
			const cards = Math.ceil(pills / drug.card);
			const packs = Math.ceil(pills / drug.pack);
			const cardsPerPack = drug.pack / drug.card;

			const row = `
				<tr>
					<td>${index + 1}</td>
					<td>${drug.name}</td>
					<td>${cards} (${cardsPerPack.toFixed(2)} ${cardsPerPack < 2 ? 'card' : 'cards'} per pack)</td>
					<td>${packs}</td>
				</tr>
			`;
			tableBody.insertAdjacentHTML('beforeend', row);
		});
	}

	// Render lần đầu với 30 ngày
	renderTable(30);

	form.addEventListener('submit', (e) => {
		e.preventDefault();
		const days = parseInt(daysInput.value);
		if (!isNaN(days) && days > 0) {
			renderTable(days);
		}
	});
</script>

<!-- add footer -->
<%- include('includes/_footer') %>
<!-- end footer-->
